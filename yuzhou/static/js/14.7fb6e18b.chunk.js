webpackJsonp([14],{896:function(e,t,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(24),p=(i.n(a),i(25)),c=i.n(p),l=i(16),u=(i.n(l),i(17)),h=i.n(u),d=i(11),f=(i.n(d),i(12)),y=i.n(f),v=i(18),T=(i.n(v),i(19)),g=i.n(T),m=i(26),b=(i.n(m),i(27)),O=i.n(b),L=i(0),E=i.n(L),S=i(2),I=i(10),N=i(979),w=i(15),C=i(980),D=i(1),j=i(14),k=i.n(j),x=i(115),P=(i.n(x),function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}()),R=function(e){function t(e){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));i.code=i.props.history.location.state.code,i.groupList=i.props.history.location.state.groupList,i.dayIndex=i.props.history.location.state.dayIndex,i.pointType=i.props.history.location.state.pointType,i.dayList=i.groupList&&i.groupList.length>i.dayIndex?i.groupList[i.dayIndex]:[],i.selectTypeList=[];for(var n=0;n<i.dayList.length;n++){var s=i.dayList[n],a=s.Code;(a.indexOf("JQ")>=0&&i.pointType===D.h.You||a.indexOf("JD")>=0&&i.pointType===D.h.Zhu||a.indexOf("CT")>=0&&i.pointType===D.h.Chi||a.indexOf("SD")>=0&&i.pointType===D.h.Gou||a.indexOf("SQ")>=0&&i.pointType===D.h.Gou||a.indexOf("YL")>=0&&i.pointType===D.h.Yu)&&i.selectTypeList.push(s)}i.getNavTitle(),i.itemSelectTapped=i.itemSelectTapped.bind(i),i.addSubmitTapped=i.addSubmitTapped.bind(i),i.pointDetailTapped=i.pointDetailTapped.bind(i),i.renderRow=i.renderRow.bind(i),i.onRefresh=i.onRefresh.bind(i),i.loadNextPage=i.loadNextPage.bind(i);var p=new O.a.DataSource({rowHasChanged:function(e,t){return e!==t},sectionHeaderHasChanged:function(e,t){return e!==t}});return i.state={dataSource:p.cloneWithRows(i.props.dataList?i.props.dataList:[])},i}return s(t,e),P(t,[{key:"componentDidMount",value:function(){this.props.selectList||this.props.dispatch(Object(C.d)(this.code,this.selectTypeList)),this.props.dataList||this.onRefresh(),this.restoreScrollViewPosition()}},{key:"componentWillUnmount",value:function(){if(this.props.dataList){(0,this.props.dispatch)(Object(C.c)(this.code))}}},{key:"componentDidUpdate",value:function(e,t,i){if(this.props.dataList!==e.dataList){var n=new O.a.DataSource({rowHasChanged:function(e,t){return e!==t},sectionHeaderHasChanged:function(e,t){return e!==t}});this.setState({dataSource:n.cloneWithRows(this.props.dataList?this.props.dataList:[])})}}},{key:"render",value:function(){var e=this;return E.a.createElement("div",{className:"journeyAddPoint"},E.a.createElement(y.a,{mode:"dark",className:"navBar",icon:E.a.createElement(g.a,{type:"left"}),onLeftClick:function(){var t=e.props.dispatch;e.props.history.goBack(),t(Object(C.c)(e.code))},rightContent:E.a.createElement("div",{style:{backgroundColor:"#00c6ad",color:"#fff",fontSize:"14px",height:"25px",width:"30px",textAlign:"center",lineHeight:"25px",borderRadius:"12px"}},this.props.selectList?this.props.selectList.length:this.selectTypeList.length)},this.naviTitle),E.a.createElement(I.a,{style:{backgroundColor:"#edecf2"}},E.a.createElement("div",{className:"headerBox"},"\u8bf7\u9009\u62e9\u6b64\u6b21\u884c\u7a0b\u65b0\u589e\u666f\u70b9(\u591a\u9009),\u8bf7\u70b9\u51fb\u56fe\u7247\u9009\u62e9:"),this.renderListView(),E.a.createElement("div",{className:"submitBox",onClick:function(){return e.addSubmitTapped()}},"\u786e\u5b9a"),this.props.isFetching?E.a.createElement(h.a,{toast:!0,text:"Loading..."}):null))}},{key:"renderListView",value:function(){var e=this;return this.props.dataList&&0!==this.props.dataList.length?E.a.createElement(O.a,{className:"listView",ref:function(t){return e.listView=t},dataSource:this.state.dataSource,renderRow:this.renderRow,style:{overflow:"auto"},pullToRefresh:E.a.createElement(c.a,{refreshing:this.props.isFetching,onRefresh:this.onRefresh}),onEndReached:this.loadNextPage,initialListSize:this.props.dataList.length,pageSize:20,scrollRenderAheadDistance:500,scrollEventThrottle:50,onEndReachedThreshold:20}):null}},{key:"renderRow",value:function(e,t,i){return E.a.createElement(N.a,{key:i,item:e,itemSelectTapped:this.itemSelectTapped,pointDetailTapped:this.pointDetailTapped})}},{key:"onRefresh",value:function(){var e=this.props.userId?this.props.userId:132,t=this.props.selectList?this.props.selectList:this.selectTypeList;this.props.dispatch(Object(C.a)(this.code,e,this.itemType,1,t))}},{key:"loadNextPage",value:function(){var e=this.props.pageIndex?this.props.pageIndex+1:1,t=this.props.userId?this.props.userId:132,i=this.props.selectList?this.props.selectList:this.selectTypeList;this.props.dispatch(Object(C.a)(this.code,t,this.itemType,e,i))}},{key:"getNavTitle",value:function(){this.pointType===D.h.CanTing?(this.itemType=2,this.naviTitle="\u9910\u5385"):this.pointType===D.h.Zhu?(this.itemType=1,this.naviTitle="\u9152\u5e97"):this.pointType===D.h.You?(this.itemType=0,this.naviTitle="\u666f\u70b9"):this.pointType===D.h.Gou?(this.itemType=4,this.naviTitle="\u8d2d\u7269"):this.pointType===D.h.Yu&&(this.itemType=3,this.naviTitle="\u5a31\u4e50"),this.naviTitle="\u65b0\u589e"+this.naviTitle}},{key:"itemSelectTapped",value:function(e,t){e=Object.assign({},e);var i=[].concat(n(this.props.dataList)),r=[].concat(n(this.props.selectList));if(e.isSelect){e.isSelect=!1;for(var o=void 0,s=0;s<r.length;s++){var a=r[s];if(e.Code===a.Code){o=s;break}}r.splice(o,1)}else e.isSelect=!0,r.push(e);for(var p=0;p<i.length;p++){var c=i[p];if(c.Code===e.Code){c.isSelect=e.isSelect,i[p]=Object.assign({},c);break}}this.props.dispatch(Object(C.b)(this.code,i)),this.props.dispatch(Object(C.d)(this.code,r))}},{key:"pointDetailTapped",value:function(e){this.cacheScrollOffset();var t=e.Code;t.indexOf("JQ")>=0?this.props.history.push("/scenic/detail/"+t):t.indexOf("JD")>=0?this.props.history.push("/hotel/detail/"+t):t.indexOf("CT")>=0?this.props.history.push("/restaurant/detail/"+t):t.indexOf("SD")>=0||t.indexOf("SQ")>=0?this.props.history.push("/shopping/detail/"+t):t.indexOf("YL")>=0&&this.props.history.push("/fun/detail/"+t)}},{key:"addSubmitTapped",value:function(){var e=this.getEditDoneDayList(),t=[].concat(n(this.groupList));t[this.dayIndex]=e;var i=this.props.dispatch;i(Object(C.e)(this.code,t)),this.props.history.goBack(),i(Object(C.c)(this.code))}},{key:"getEditDoneDayList",value:function(){for(var e=[].concat(n(this.dayList)),t=[].concat(n(this.props.selectList)),i=[],r=0;r<t.length;r++)for(var o=t[r],s=0;s<this.selectTypeList.length;s++){var a=this.selectTypeList[s];if(o.Code===a.Code){i.push(o);break}}for(var p=[],c=0;c<t.length;c++){for(var l=t[c],u=!0,h=0;h<i.length;h++){var d=i[h];if(l.Code===d.Code){u=!1;break}}u&&p.push(l)}for(var f=[],y=0;y<this.selectTypeList.length;y++){for(var v=t[y],T=!0,g=0;g<i.length;g++){var m=i[g];if(v.Code===m.Code){T=!1;break}}T&&f.push(v)}for(var b=0;b<f.length;b++)for(var O=f[b],L=[].concat(n(e)),E=0;E<L.length;E++){var S=L[E];if(O.Code===S.Code){e.splice(E,1);break}}for(var I=0;I<p.length;I++){var N=p[I];e.push(N)}return e}},{key:"cacheScrollOffset",value:function(){var e=k.a.findDOMNode(this.listView).scrollTop;this.props.dispatch(Object(C.f)(this.code,e))}},{key:"restoreScrollViewPosition",value:function(){this.listView&&!isNaN(this.props.scrollViewOffset)&&(k.a.findDOMNode(this.listView).scrollTop=this.props.scrollViewOffset)}}]),t}(L.PureComponent),_=function(e,t){var i=e.journey.addPointScreen[t.history.location.state.code];return Object.assign({},i,{userId:w.a.getUserId(e)})};R=Object(S.b)(_)(R),t.default=R},979:function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function o(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=i(0),a=i.n(s),p=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),c=function(e){function t(){return n(this,t),r(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),p(t,[{key:"render",value:function(){var e=this,t=this.props.item,i=t.GetImage.SmallImageFrontUrl?t.GetImage.SmallImageFrontUrl:"";return a.a.createElement("div",{className:"rowItem"},a.a.createElement("div",{className:"rowImage",style:{backgroundImage:"url("+i+")"},onClick:function(){return e.props.itemSelectTapped(t)}},t.isSelect?a.a.createElement("div",{className:"selectHighBg"}):null),a.a.createElement("div",{className:"rowRight",onClick:function(){return e.props.pointDetailTapped(t)}},a.a.createElement("div",{className:"rowInfo"},a.a.createElement("div",{className:"pointName"},t.Name),a.a.createElement("div",{className:"pointName"},"\u6e38\u73a9\u65f6\u95f4\uff1a",t.PlayTime,"\u5c0f\u65f6"),t.Price&&t.Price.length>0?a.a.createElement("div",{className:"pointPrice"},parseInt(t.Price,10)>0?"\uffe5"+t.Price+"\u4eba":"\u514d\u8d39"):null),a.a.createElement("div",{className:"rowMore"},"\u8be6\u60c5>")))}}]),t}(s.PureComponent);t.a=c},980:function(e,t,i){"use strict";function n(e){return{type:d.b.JOURNEY.ADDPOINT.GO_BACK,journeyId:e}}function r(e,t,i,n,r){return function(o,s){return o(l(e,n)),c(e,t,i,n).then(function(t){for(var i=t.results,s=0;s<i.length;s++)for(var a=i[s],p=0;p<r.length;p++){var c=r[p];if(a.Code===c.Code){a.isSelect=!0;break}}o(u(e,n,i))}).catch(function(t){o(h(e,n,t))})}}function o(e,t){return{type:d.b.JOURNEY.ADDPOINT.DATALIST_CHANGE,journeyId:e,dataList:t}}function s(e,t){return{type:d.b.JOURNEY.ADDPOINT.SELECTLIST_CHANGE,journeyId:e,selectList:t}}function a(e,t){return{type:d.b.JOURNEY.ADDPOINT.SELECT_POINT_DONE,journeyId:e,groupList:t}}function p(e,t){return{type:d.b.JOURNEY.ADDPOINT.SET_SCROLL_OFFSET,scrollViewOffset:t,journeyId:e}}function c(e,t,i,n){var r={key:i,pageIndex:n,pageSize:10};return f.a.postToPortal(d.q.JOURNEY.FillTour,r,null,!0).then(function(e){return e.json()})}function l(e,t){return{type:d.b.JOURNEY.ADDPOINT.GET_LIST_REQUEST,journeyId:e,pageIndex:t}}function u(e,t,i){return{type:d.b.JOURNEY.ADDPOINT.GET_LIST_SUCCESS,journeyId:e,pageIndex:t,result:i}}function h(e,t,i){return{type:d.b.JOURNEY.ADDPOINT.GET_LIST_FAILURE,journeyId:e,pageIndex:t,message:i}}t.c=n,t.a=r,t.b=o,t.d=s,t.e=a,t.f=p;var d=i(1),f=i(8)}});
//# sourceMappingURL=14.7fb6e18b.chunk.js.map