webpackJsonp([6],{885:function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(28),r=(a.n(o),a(29)),p=a.n(r),c=a(16),h=(a.n(c),a(17)),l=a.n(h),d=a(0),u=a.n(d),m=a(2),f=a(10),y=a(70),g=a(14),v=a.n(g),w=a(290),M=a.n(w),E=a(1),T=a(54),k=a(901),L=a(289),b=a(158),P=(a.n(b),a(23),a(15)),C=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),N=[{title:"\u51fa\u884c\u5fc5\u770b",list:[{name:"\u666f\u533a",type:E.h.You},{name:"\u9152\u5e97",type:E.h.Zhu},{name:"\u9910\u996e",type:E.h.CanTing},{name:"\u8d2d\u7269",type:E.h.Gou},{name:"\u5a31\u4e50",type:E.h.Yu}]}],I=function(e){function t(e){i(this,t);var a=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={mapHeight:0,panelBottom:0},a.deSelectPoi=a.deSelectPoi.bind(a),a.searchTypeButtonTapped=a.searchTypeButtonTapped.bind(a),a.hidePanel=a.hidePanel.bind(a),a.togglePanel=a.togglePanel.bind(a),a.searchBarFocus=a.searchBarFocus.bind(a),a.dailPhone=a.dailPhone.bind(a),a.navTo=a.navTo.bind(a),a.showDetails=a.showDetails.bind(a),a}return s(t,e),C(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(k.c)(!0)),this.updateWindowDimensions()}},{key:"componentDidUpdate",value:function(e,t,a){var i=!e.baiduMapInited&&this.props.baiduMapInited;i=i||!e.lat&&this.props.lat!==e.lat,i&&this.updateFromLocation(this.props),this.props.searchType!==e.searchType&&void 0!==this.props.searchType&&this.props.dispatch(Object(k.a)(this.props.searchType,this.props.keywords,this.props.lat,this.props.lng)),this.props.dataList!==e.dataList&&this.addMarkers(this.props.dataList,this.props.searchType),this.props.height&&!e.height&&this.updateWindowDimensions(),this.props.nativeSearchKeywords!==e.nativeSearchKeywords&&(this.updateKeyword(this.props.nativeSearchKeywords),this.searchByKeyword(this.props.nativeSearchKeywords)),this.props.getElementMapDataList!==e.getElementMapDataList&&0===this.props.getElementMapDataList&&(this.props.dispatch(Object(L.a)({getElementMapDataList:1})),this.sendCommonDataList())}},{key:"render",value:function(){var e=this;return u.a.createElement("div",{className:"isFromNativeApp elementMapPage"},u.a.createElement(f.a,{ref:function(t){e.scrollView=t?t.getWrappedInstance():e.scrollView}},u.a.createElement("div",{id:"elementMap",ref:function(t){e.mapView=t},style:{height:this.state.mapHeight+"px"}}),u.a.createElement(M.a,{transitionName:"elementMapPanel",transitionAppearTimeout:500,transitionEnterTimeout:500,transitionLeaveTimeout:300},this.props.isPanelShowing?u.a.createElement("div",{key:"1",className:"mapTypePanel",onClick:this.hidePanel},this.renderPanelDetails()):null),this.renderFooterDetails(),this.renderSegmentButtonView(),this.props.isFetching?u.a.createElement(l.a,{toast:!0,text:"Loading..."}):null))}},{key:"renderSegmentButtonView",value:function(){var e=this,t=this.getSearchTypeName();return t&&t.length>0?u.a.createElement("div",{className:"searchTypeName",onClick:function(){return e.togglePanel()}},t):null}},{key:"renderPanelDetails",value:function(){var e=this;return u.a.createElement("div",{style:{position:"absolute",top:"0px",width:"100%",overflow:"scroll",backgroundColor:"#fff"}},u.a.createElement("div",{style:{overflow:"scroll",left:"0",right:"0"}},N.map(function(t,a){return u.a.createElement("div",{key:t.title,className:"typeBoxView"},u.a.createElement("div",{className:"typeName"},t.title),u.a.createElement("div",{className:"typeView"},t.list.map(function(t,a){return u.a.createElement("div",{key:t.type,onClick:function(){return e.searchTypeButtonTapped(t.type)},className:"typeButton"},t.name)})))})))}},{key:"renderFooterDetails",value:function(){if(!this.props.selectedItem)return null;var e=a(902),t=a(903),i=a(904);return u.a.createElement("div",{className:"footerDetails"},u.a.createElement("div",{className:"footerDetailsName"},this.props.selectedItem.name),u.a.createElement("div",{className:"footerDetailsAddress"},this.props.selectedItem.distance,"\xa0\xa0\xa0\xa0",this.props.selectedItem.address),u.a.createElement("div",{className:"footerDetailsButtons"},u.a.createElement("div",{className:this.props.selectedItem.telephone?"footerDetailsButton":"footerDetailsButton footerDetailsButtonDisabled",onClick:this.dailPhone},u.a.createElement("img",{src:e,alt:""})," \u7535\u8bdd"),u.a.createElement("div",{className:"footerDetailsSplitLine"}),u.a.createElement("div",{className:this.props.selectedItem.latitude&&this.props.selectedItem.longitude?"footerDetailsButton":"footerDetailsButton footerDetailsButtonDisabled",onClick:this.navTo},u.a.createElement("img",{src:t,alt:""})," \u5230\u8fd9\u53bb"),u.a.createElement("div",{className:"footerDetailsSplitLine"}),u.a.createElement("div",{className:this.isEntitySearchType()?"footerDetailsButton footerDetailsButtonDisabled":"footerDetailsButton",onClick:this.showDetails},u.a.createElement("img",{src:i,alt:""})," \u8be6\u60c5")))}},{key:"initMap",value:function(){this.markerIcon=new window.BMap.Icon(a(284),new window.BMap.Size(30,30),{anchor:new window.BMap.Size(15,30),imageSize:new window.BMap.Size(30,30)}),this.selectedMarkerIcon=new window.BMap.Icon(a(905),new window.BMap.Size(30,30),{anchor:new window.BMap.Size(15,30),imageSize:new window.BMap.Size(30,30)}),this.map=this.map?this.map:new window.BMap.Map("elementMap"),this.map.centerAndZoom(new window.BMap.Point(T.a.instance.appCityLongitude,T.a.instance.appCityLatitude),16),this.map.addControl(new window.BMap.NavigationControl({type:window.BMAP_NAVIGATION_CONTROL_SMALL,anchor:window.BMAP_ANCHOR_BOTTOM_RIGHT,enableGeolocation:!0,offset:new window.BMap.Size(20,20)})),this.map.addControl(new window.BMap.GeolocationControl({enableAutoLocation:!1})),this.map.addEventListener("click",this.deSelectPoi),this.map.addEventListener("dragstart",this.deSelectPoi)}},{key:"updateWindowDimensions",value:function(){var e=this,t=window.innerHeight-v.a.findDOMNode(this).parentNode.offsetTop;this.setState({mapHeight:t,panelBottom:window.innerHeight/3},function(){e.updateFromLocation(e.props)})}},{key:"updateFromLocation",value:function(e){if(e.baiduMapInited&&this.initMap(),e.baiduMapInited&&e.lat&&e.lng&&(!e.searchType||e.searchType.length<=0)){var t=E.h.You;this.props.dispatch(Object(k.g)(t))}else e.dataList&&e.searchType&&(this.addMarkers(e.dataList,e.searchType),this.map.setZoom(e.mapZoom),this.map.setCenter(new window.BMap.Point(e.centerLng,e.centerLat)))}},{key:"updateKeyword",value:function(e){this.props.dispatch(Object(k.e)(e))}},{key:"searchByKeyword",value:function(e){this.props.dispatch(Object(k.a)(this.props.searchType,e,this.props.lat,this.props.lng))}},{key:"searchBarFocus",value:function(){if(this.deSelectPoi(),this.hidePanel(),this.isEntitySearchType())return void p.a.success("\u6682\u53ea\u652f\u6301\u666f\u533a\uff0c\u9152\u5e97\uff0c\u9910\u996e\uff0c\u8d2d\u7269\uff0c\u5a31\u4e50\u7684\u5173\u952e\u5b57\u67e5\u8be2\uff01",2)}},{key:"isEntitySearchType",value:function(){var e=this.props.searchType;return!(e===E.h.You||e===E.h.Zhu||e===E.h.CanTing||e===E.h.Gou||e===E.h.Yu)}},{key:"togglePanel",value:function(){this.deSelectPoi(),this.props.dispatch(Object(k.d)(!this.props.isPanelShowing))}},{key:"hidePanel",value:function(){this.deSelectPoi(),this.props.dispatch(Object(k.d)(!1))}},{key:"addMarkers",value:function(e,t){var a=this;if(this.props.dispatch(Object(k.c)(!1)),this.map.clearOverlays(),this.map&&e&&0!==e.length){this.markers=[];for(var i=[],n=0;n<e.length;n++)!function(n){var s=e[n],o=void 0;o=t===E.h.You||t===E.h.Zhu||t===E.h.CanTing||t===E.h.Gou||t===E.h.Yu?new window.BMap.Point(s.Longitude,s.Latitude):new window.BMap.Point(s.longitude,s.latitude);var r=new window.BMap.Marker(o,{icon:a.markerIcon});r.addEventListener("click",function(e){e.domEvent.stopPropagation(),this.markerTapped(n)}.bind(a)),i.push(o),a.markers.push(r)}(n);this.markerClusterer||(this.markerClusterer=new window.BMapLib.MarkerClusterer(this.map)),this.markerClusterer.clearMarkers(),this.markerClusterer.addMarkers(this.markers),this.map.setViewport(i)}}},{key:"deSelectPoi",value:function(){if(this.props.dispatch(Object(k.h)(null)),this.markers&&this.markers.length>0){for(var e=0;e<this.markers.length;e++){var t=this.markers[e];t.getIcon()!==this.markerIcon&&t.setIcon(this.markerIcon)}this.updateMapControlPosition(80)}}},{key:"updateMapControlPosition",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:140,t=this.mapView.getElementsByClassName("BMap_noprint"),a=0;a<t.length;a++){t[a].style.cssText+="bottom: "+e+"px;"}}},{key:"markerTapped",value:function(e){this.updateMapControlPosition();for(var t=0;t<this.markers.length;t++){var a=this.markers[t];e===t?a.setIcon(this.selectedMarkerIcon):a.getIcon()!==this.markerIcon&&a.setIcon(this.markerIcon)}var i=this.elementItemToCommonItem(this.props.dataList[e]);this.props.dispatch(Object(k.h)(i))}},{key:"searchTypeButtonTapped",value:function(e){var t=this;this.deSelectPoi(),this.props.searchType!==e&&(this.props.keywords&&this.props.keywords.length>0?this.props.dispatch(Object(k.e)("")).then(function(){return t.props.dispatch(Object(k.g)(e))}):this.props.dispatch(Object(k.g)(e)))}},{key:"setMapZoomAndCenterLocation",value:function(){if(this.map){var e=this.map.getCenter(),t=this.map.getZoom(),a=e.lat,i=e.lng;this.props.dispatch(Object(k.f)(t,a,i))}}},{key:"dailPhone",value:function(){this.setMapZoomAndCenterLocation();var e=this.props.selectedItem;e.telephone&&e.telephone.length>0&&(this.props.isFromNativeApp&&window.postMessage?this.sendMessageToNative(E.i.DIAL,{phoneNumber:e.telephone}):P.a.openTel(e.telephone))}},{key:"navTo",value:function(){this.setMapZoomAndCenterLocation();var e=this.props.selectedItem;e.latitude&&e.latitude>0&&e.longitude&&e.longitude>0&&(this.props.isFromNativeApp&&window.postMessage?this.sendMessageToNative(E.i.MAP_NAV,{code:e.code,toLat:e.latitude,toLng:e.longitude}):this.props.history.push("/map/mapNav/"+e.code+"/"+e.latitude+"/"+e.longitude))}},{key:"showDetails",value:function(){if(!this.isEntitySearchType()){this.setMapZoomAndCenterLocation();var e=this.props.selectedItem,t=this.props.searchType;window.postMessage?this.sendMessageToNative(E.i.ELEMENT_DETAIL,{type:t,imageUrl:e.imageUrl,name:e.name,code:e.code}):t===E.h.You?this.props.history.push("/scenic/detail/"+e.code):t===E.h.Zhu?this.props.history.push("/hotel/detail/"+e.code):t===E.h.CanTing?this.props.history.push("/restaurant/detail/"+e.code):t===E.h.Gou?this.props.history.push("/shopping/detail/"+e.code):t===E.h.Yu&&this.props.history.push("/fun/detail/"+e.code)}}},{key:"getSearchTypeName",value:function(){for(var e=this.props.searchType,t="",a=0;a<N.length;a++){for(var i=N[a].list,n=0;n<i.length;n++){var s=i[n];if(s.type===e){t=s.name;break}}if(t&&t.length>0)break}return t}},{key:"elementItemToCommonItem",value:function(e){var t=void 0,a=void 0,i=void 0,n=void 0,s=void 0,o=void 0,r=void 0,p=void 0,c=this.props.searchType,h=this.getSearchTypeName();return e.Distance=e.Distance?e.Distance:e.distance,e.distance=e.distance?e.distance:e.Distance,c===E.h.You||c===E.h.Zhu?(t=e.CnName,a=e.Code,i=e.Distance?parseFloat(e.Distance).toFixed(1)+"\u5343\u7c73":"",n=e.Telephone?e.Telephone:"",s=e.Address&&e.Address.length>0?e.Address:"\u5730\u5740\u6682\u65e0",o=e.Latitude,r=e.Longitude,e.GetImage&&(p=e.GetImage.ImageFrontUrl)):c===E.h.CanTing||c===E.h.Gou||c===E.h.Yu?(t=e.CnName,a=e.Code,i=e.distance?e.distance.toFixed(1)+"\u5343\u7c73":"",n=e.Telephone?e.Telephone:"",s=e.Address&&e.Address.length>0?e.Address:"\u5730\u5740\u6682\u65e0",o=e.Latitude,r=e.Longitude,e.GetImage&&(p=e.GetImage.SmallImageFrontUrl)):(t=e.CnName,a=e.Code,i=e.distance?e.distance.toFixed(1)+"\u5343\u7c73":"",n=null,s=e.Address&&e.Address.length>0?e.Address:h.replace("/",",")+"  \u5730\u5740\u6682\u65e0",o=e.Latitude,r=e.Longitude,e.GetImage&&(p=e.GetImage.SmallImageFrontUrl)),{name:t,code:a,distance:i,telephone:n,address:s,latitude:o,longitude:r,imageUrl:p,type:c}}},{key:"dataListToCommonList",value:function(){if(!this.props.dataList||0===this.props.dataList.length)return[];for(var e=[],t=0;t<this.props.dataList.length;t++){var a=this.props.dataList[t];e.push(this.elementItemToCommonItem(a))}return e}},{key:"sendCommonDataList",value:function(){window.postMessage&&window.postMessage(JSON.stringify({type:E.i.ELEMENT_MAP_DATALIST,data:{dataList:this.dataListToCommonList(),type:this.props.searchType,title:this.getSearchTypeName()}}),"*")}}]),t}(y.a),A=function(e,t){var a=e.map.elementMap;return Object.assign({},a,{baiduMapInited:e.system.baiduMapInited,markerClusterInited:e.system.markerClusterInited,lat:e.system.latitude,lng:e.system.longitude,isFromNativeApp:e.native.isFromNativeApp},e.native.windowSize,{nativeSearchKeywords:e.native.elemantMapSearchKeywords,getElementMapDataList:e.native.getElementMapDataList})};I=Object(m.b)(A)(I),t.default=I},901:function(e,t,a){"use strict";function i(){return{type:v.b.MAP.ELEMENTMAP.GO_BACK}}function n(e){return{type:v.b.MAP.ELEMENTMAP.IS_PANEL_SHOWING_CHANGE,isPanelShowing:e}}function s(e){return{type:v.b.MAP.ELEMENTMAP.IS_FETCHING_CHANGE,isFetching:e}}function o(e){return function(t,a){return t(r(e)),new Promise(function(e){e()})}}function r(e){return{type:v.b.MAP.ELEMENTMAP.KEYWORDS_CHANGE,keywords:e}}function p(e,t,a){return function(i,n){return i(c(e,t,a)),new Promise(function(e){e()})}}function c(e,t,a){return{type:v.b.MAP.ELEMENTMAP.MAPZOOM_AND_CENTERLOCATION_CHANGE,mapZoom:e,centerLat:t,centerLng:a}}function h(e){return{type:v.b.MAP.ELEMENTMAP.SEARCHTYPE_CHANGE,searchType:e}}function l(e,t,a,i){return function(n,s){return n(f(e,t,a,i)),u(e,t,a,i).then(function(s){n(y(e,t,a,i,s))}).catch(function(s){n(g(e,t,a,i,s))})}}function d(e){return{type:v.b.MAP.ELEMENTMAP.SELECTEDITEM_CHANGE,selectedItem:e}}function u(e,t,a,i){return e===v.h.You?Object(M.a)(t,a,i):e===v.h.Zhu?Object(E.a)(t,a,i):e===v.h.CanTing?Object(T.a)(t,a,i):e===v.h.Gou?Object(k.a)(t,a,i):e===v.h.Yu?Object(L.a)(t,a,i):m(e,t,a,i)}function m(e,t,a,i){var n=void 0,s={conditionParams:{Page:{PageIndex:1,PageSize:v.a},Search:[],Order:[]},CityCode:v.d,lat:a,lng:i};return e===v.h.Toilet?n=v.q.COMMON_SERVICE.ToiletList:e===v.h.Bank?n=v.q.COMMON_SERVICE.BankList:e===v.h.Hopsital?n=v.q.COMMON_SERVICE.HospitalList:e===v.h.PostOffice?n=v.q.COMMON_SERVICE.PostOfficeList:e===v.h.Gasstation&&(n=v.q.COMMON_SERVICE.GasstationList),w.a.getFromPortal(n,s).then(function(e){return e.json()})}function f(e,t,a,i){return{type:v.b.MAP.ELEMENTMAP.GET_LIST_REQUEST,searchType:e,keywords:t}}function y(e,t,a,i,n){return{type:v.b.MAP.ELEMENTMAP.GET_LIST_SUCCESS,searchType:e,keywords:t,result:n}}function g(e,t,a,i,n){return{type:v.b.MAP.ELEMENTMAP.GET_LIST_FAILURE,searchType:e,keywords:t,message:n}}t.b=i,t.d=n,t.c=s,t.e=o,t.f=p,t.g=h,t.a=l,t.h=d;var v=a(1),w=a(8),M=a(286),E=a(159),T=a(160),k=a(162),L=a(161)},902:function(e,t,a){e.exports=a.p+"static/media/ico_map_phone@2x.02235dc5.png"},903:function(e,t,a){e.exports=a.p+"static/media/ico_map_go@2x.a847eed7.png"},904:function(e,t,a){e.exports=a.p+"static/media/ico_map_detail@2x.8a6f5193.png"},905:function(e,t,a){e.exports=a.p+"static/media/common_poi_selected@2x.38730eb3.png"}});
//# sourceMappingURL=6.18cfccdc.chunk.js.map