webpackJsonp([10],{894:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var r=n(16),s=(n.n(r),n(17)),p=n.n(s),c=n(11),d=(n.n(c),n(12)),l=n.n(d),u=n(18),h=(n.n(u),n(19)),m=n.n(h),f=n(0),w=n.n(f),y=n(2),v=n(10),b=n(14),g=n.n(b),L=n(54),M=n(969),k=n(115),S=(n.n(k),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),I=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.markerIcon=void 0,n.selectIcon=void 0,n.darkIcon=void 0,n.markerList=[],n.code=n.props.history.location.state.code,n.groupList=n.props.history.location.state.groupList,n.daysClick=n.daysClick.bind(n),n.journeyPointTapped=n.journeyPointTapped.bind(n),n.state={mapHeight:0},n}return a(t,e),S(t,[{key:"componentDidMount",value:function(){this.props.dispatch(Object(M.c)(this.code,!0)),this.updateWindowDimensions()}},{key:"componentDidUpdate",value:function(e,t,n){this.props.baiduMapInited&&!e.baiduMapInited&&this.baiduMapInitedDone(),this.props.dayIndex!==e.dayIndex&&this.addMarkerAndLine(this.props.dayIndex)}},{key:"render",value:function(){var e=this;return w.a.createElement("div",{className:"journeyMapLine"},w.a.createElement(l.a,{mode:"dark",className:"navBar",icon:w.a.createElement(m.a,{type:"left"}),onLeftClick:function(){var t=e.code,n=e.props.dispatch;e.props.history.goBack(),n(Object(M.b)(t))}},"\u884c\u7a0b\u5730\u56fe"),w.a.createElement(v.a,null,this.renderTopScrollView(),w.a.createElement("div",{id:"journeyMapLine",ref:function(t){e.mapView=t},style:{height:this.state.mapHeight+"px"}}),w.a.createElement("div",{className:"bottomBox",ref:function(t){e.bottomBox=t}},this.renderBottomScrollView()),this.props.isFetching?w.a.createElement(p.a,{toast:!0,text:"Loading..."}):null))}},{key:"renderTopScrollView",value:function(){var e=this;return w.a.createElement("div",{className:"topBar",ref:function(t){e.topBox=t}},w.a.createElement("div",{className:"days-item"},0===this.props.dayIndex?w.a.createElement("p",{className:"days-select",onClick:function(){return e.daysClick(0)}},"\u5168\u90e8"):w.a.createElement("p",{className:"days-noSelect",onClick:function(){return e.daysClick(0)}},"\u5168\u90e8")),this.groupList&&0!==this.groupList.length?this.groupList.map(function(t,n){return w.a.createElement("div",{className:"days-item",key:n},e.props.dayIndex===n+1?w.a.createElement("p",{className:"days-select",onClick:function(){return e.daysClick(n+1)}},"\u7b2c",n+1,"\u5929"):w.a.createElement("p",{className:"days-noSelect",onClick:function(){return e.daysClick(n+1)}},"\u7b2c",n+1,"\u5929"))}):null)}},{key:"renderBottomScrollView",value:function(){var e=this;return this.props.showList&&0!==this.props.showList.length?this.props.showList.map(function(t,n){return w.a.createElement("div",{className:"routemap-bottom-item",key:n,onClick:function(){return e.journeyPointTapped(t)}},w.a.createElement("div",{className:"routemap-bottom-left"},w.a.createElement("img",{src:t.GetImage.SmallImageFrontUrl,alt:""}),w.a.createElement("div",{className:"routemap_type"},e.getPointTypeName(t.Code))),w.a.createElement("div",{className:"routemap-bottom-detail"},w.a.createElement("p",null,t.Name),t.PlayTime&&parseInt(t.PlayTime,10)>0?w.a.createElement("p",null,"\u6e38\u73a9\u65f6\u95f4\uff1a",t.PlayTime,"\u5c0f\u65f6"):null,t.Price&&parseInt(t.Price,10)>0?w.a.createElement("span",null,w.a.createElement("p",null,"\u4ef7\u683c\uff1a"),w.a.createElement("p",null,"\xa5",t.Price)):null))}):null}},{key:"initMap",value:function(){this.map||(this.bottomChildW=window.innerWidth-50,this.markerIcon=new window.BMap.Icon(n(970),new window.BMap.Size(30,30),{anchor:new window.BMap.Size(15,30),imageSize:new window.BMap.Size(30,30)}),this.selectIcon=new window.BMap.Icon(n(971),new window.BMap.Size(30,30),{anchor:new window.BMap.Size(15,30),imageSize:new window.BMap.Size(30,30)}),this.darkIcon=new window.BMap.Icon(n(972),new window.BMap.Size(30,30),{anchor:new window.BMap.Size(15,30),imageSize:new window.BMap.Size(30,30)}),this.map=this.map?this.map:new window.BMap.Map("journeyMapLine"),this.map.centerAndZoom(new window.BMap.Point(L.a.instance.appCityLongitude,L.a.instance.appCityLatitude),16),this.map.addControl(new window.BMap.NavigationControl({type:window.BMAP_NAVIGATION_CONTROL_SMALL,anchor:window.BMAP_ANCHOR_TOP_RIGHT,enableGeolocation:!0,offset:new window.BMap.Size(20,20)})),this.map.addControl(new window.BMap.GeolocationControl({enableAutoLocation:!1,anchor:window.BMAP_ANCHOR_TOP_LEFT})),this.map.addEventListener("click",this.deSelectPoi),this.map.addEventListener("dragstart",this.deSelectPoi))}},{key:"updateWindowDimensions",value:function(){var e=this,t=window.innerHeight-g.a.findDOMNode(this).parentNode.offsetTop-40;this.setState({mapHeight:t},function(){e.props.baiduMapInited&&(e.baiduMapInitedDone(),e.props.showList&&e.props.mapZoom&&(e.addMarkerAndLine(e.props.dayIndex),e.map.setZoom(e.props.mapZoom),e.map.setCenter(new window.BMap.Point(e.props.centerLng,e.props.centerLat)),g.a.findDOMNode(e.topBox).scrollLeft=e.props.topScrollX,g.a.findDOMNode(e.bottomBox).scrollLeft=e.props.bottomScrollX))})}},{key:"baiduMapInitedDone",value:function(){this.initMap();var e=this.props.dayIndex?this.props.dayIndex:0;this.daysClick(e)}},{key:"daysClick",value:function(e){if(this.map&&this.groupList&&(!this.props.dayIndex||this.props.dayIndex!==e)){g.a.findDOMNode(this.bottomBox).scrollLeft=0;var t=this.getBottomShowList(e);this.props.dispatch(Object(M.a)(this.code,e,t))}}},{key:"getBottomShowList",value:function(e){if(e>0&&this.groupList.length>=e)return this.groupList[e-1];for(var t=[],n=0;n<this.groupList.length;n++)for(var o=this.groupList[n],i=0;i<o.length;i++)t.push(o[i]);return t}},{key:"addMarkerAndLine",value:function(e){var t=this;if(this.props.dispatch(Object(M.c)(this.code,!1)),this.map&&this.groupList){this.map.clearOverlays();var n=0,o=[];this.markerList=[];for(var i=0;i<this.groupList.length;i++)for(var a=this.groupList[i],r=0;r<a.length;r++)!function(r){var s=a[r],p=new window.BMap.Point(s.Longitude,s.Latitude),c="D"+(i+1),d=t.darkIcon,l="#404666",u=0===e||0!==e&&i===e-1,h="10px",m=new window.BMap.Size(4,1);u&&(n+=1,c=n.toString(),d=t.markerIcon,l="#00e6ae",h="13px",m=new window.BMap.Size(3,1),o.push(p));var f=d.size,w="width:"+(f.width/2+5)+"px;height:"+(f.height/2+5)+"px; line-height: "+(f.height/2+5)+"px;",y="<div style='text-align: center;"+w+"'>"+c+"</div>",v=new window.BMap.Marker(p,{icon:d}),b=new window.BMap.Label(y,{offset:m});b.setStyle({color:l,fontSize:h,backgroundColor:"clear",border:"0"}),v.setLabel(b),t.map.addOverlay(v);var L=s.Name,M=s.Address,k=(n-1).toString();v.addEventListener("click",function(){var e={width:100,height:80,title:"",offset:new window.BMap.Size(0,-30)},t="<span style='font-size:14px;color:#444'>"+L+"</span>";t=t+"<br><span style='font-size:13px;color:#888'>\u5730\u5740:"+M+"</span>";var n=new window.BMap.InfoWindow(t,e);if(n.addEventListener("close",function(){this.refreshMarkerStatus()}.bind(this)),this.map.openInfoWindow(n,p),u){this.refreshMarkerStatus(),v.setIcon(this.selectIcon);v.getLabel().setStyle({color:"#ffffff",fontSize:"13px",backgroundColor:"clear",border:"0"}),g.a.findDOMNode(this.bottomBox).scrollLeft=10+this.bottomChildW*Number(k)}}.bind(t)),u&&t.markerList.push(v),t.map.centerAndZoom(p,15)}(r);if(o.length>0){var s=this.map.getViewport(o);s.zoom=s.zoom>15&&o.length<=2?15:s.zoom,this.map.centerAndZoom(s.center,s.zoom);var p=new window.BMap.Polyline(o,{strokeColor:"#00e6ae",strokeWeight:1,strokeOpacity:1,strokeStyle:"dashed"});this.map.addOverlay(p)}}}},{key:"refreshMarkerStatus",value:function(){var e=!0,t=!1,n=void 0;try{for(var o,i=this.markerList[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;a.setIcon(this.markerIcon);a.getLabel().setStyle({color:"#00e6ae",fontSize:"13px",backgroundColor:"clear",border:"0"})}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}},{key:"getPointTypeName",value:function(e){if(0===e.length)return console.log("detail code null!!!"),"";var t=["JQ","JD","CT","CP","YL","SQ","SD","WD","SP"],n=["\u666f\u533a","\u9152\u5e97","\u9910\u9986","\u7f8e\u98df","\u5a31\u4e50","\u5546\u5708","\u5546\u573a","\u5546\u94fa","\u5546\u54c1"],o="",i=!0,a=!1,r=void 0;try{for(var s,p=t[Symbol.iterator]();!(i=(s=p.next()).done);i=!0){var c=s.value;if(e.indexOf(c)>=0){o=n[t.indexOf(c)];break}}}catch(e){a=!0,r=e}finally{try{!i&&p.return&&p.return()}finally{if(a)throw r}}return o}},{key:"journeyPointTapped",value:function(e){if(e){this.setMapZoomAndCenterLocation(),this.setTopBottomScrollX();var t=e.Code;t.indexOf("JQ")>=0?this.props.history.push("/scenic/detail/"+t):t.indexOf("JD")>=0?this.props.history.push("/hotel/detail/"+t):t.indexOf("CT")>=0?this.props.history.push("/restaurant/detail/"+t):t.indexOf("SD")>=0||t.indexOf("SQ")>=0?this.props.history.push("/shopping/detail/"+t):t.indexOf("YL")>=0&&this.props.history.push("/fun/detail/"+t)}}},{key:"setMapZoomAndCenterLocation",value:function(){if(this.map){var e=this.map.getCenter(),t=this.map.getZoom(),n=e.lat,o=e.lng;this.props.dispatch(Object(M.d)(this.code,t,n,o))}}},{key:"setTopBottomScrollX",value:function(){var e=g.a.findDOMNode(this.topBox).scrollLeft,t=g.a.findDOMNode(this.bottomBox).scrollLeft;this.props.dispatch(Object(M.e)(this.code,e,t))}}]),t}(f.PureComponent),O=function(e,t){var n=e.journey.mapLineScreen[t.history.location.state.code];return Object.assign({},n,{baiduMapInited:e.system.baiduMapInited})};I=Object(y.b)(O)(I),t.default=I},969:function(e,t,n){"use strict";function o(e){return{type:c.b.JOURNEY.MAPLINE.GO_BACK,journeyId:e}}function i(e,t){return{type:c.b.JOURNEY.MAPLINE.IS_FETCHING_CHANGE,journeyId:e,isFetching:t}}function a(e,t,n){return{type:c.b.JOURNEY.MAPLINE.DAYINDEX_CHANGE,journeyId:e,dayIndex:t,showList:n}}function r(e,t,n,o){return function(i,a){return i(s(e,t,n,o)),new Promise(function(e){e()})}}function s(e,t,n,o){return{type:c.b.JOURNEY.MAPLINE.MAPZOOM_AND_CENTERLOCATION_CHANGE,journeyId:e,mapZoom:t,centerLat:n,centerLng:o}}function p(e,t,n){return{type:c.b.JOURNEY.MAPLINE.TOP_BOTTOM_SCROLLX_CHANGE,journeyId:e,topScrollX:t,bottomScrollX:n}}t.b=o,t.c=i,t.a=a,t.d=r,t.e=p;var c=n(1)},970:function(e,t,n){e.exports=n.p+"static/media/point-start@2x.90e9061b.png"},971:function(e,t,n){e.exports=n.p+"static/media/point-bet@2x.d5a8cd2e.png"},972:function(e,t,n){e.exports=n.p+"static/media/map-point@2x.dc2b3a9d.png"}});
//# sourceMappingURL=10.21a710ce.chunk.js.map