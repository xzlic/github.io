webpackJsonp([9],{880:function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function n(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=a(42),c=(a.n(s),a(43)),o=a.n(c),l=a(16),m=(a.n(l),a(17)),p=a.n(m),d=a(11),u=(a.n(d),a(12)),h=a.n(u),f=a(0),E=a.n(f),I=a(2),S=a(56),v=a(14),L=a.n(v),g=a(10),y=a(1),N=a(15),k=a(897),C=a(41),T=a(61),w=a(288),b=(a.n(w),a(23)),D=function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}(),_=function(e){function t(e){i(this,t);var a=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={Score:0,PriceScore:0,ServiceScore:0,InstallationScore:0,EnvironmentScore:0,index:1,showImageBrowser:!1,imageList:[]},a.showSceneryList=a.showSceneryList.bind(a),a.showElementMarkerMap=a.showElementMarkerMap.bind(a),a.showImageBrowser=a.showImageBrowser.bind(a),a.goBack=a.goBack.bind(a),a}return n(t,e),D(t,[{key:"componentDidMount",value:function(){this.props.detailItem?this.startScoreAnimation(this.props.detailItem):this.loadData(),this.restoreScrollViewPosition()}},{key:"componentWillUnmount",value:function(){this.props&&this.props.history&&"POP"===this.props.history.action&&this.onDestroy()}},{key:"componentDidUpdate",value:function(e,t,a){e.detailItem!==this.props.detailItem&&this.props.detailItem&&this.startScoreAnimation(this.props.detailItem)}},{key:"render",value:function(){var e=this;return E.a.createElement("div",null,E.a.createElement(h.a,{mode:"dark",className:"navBar",leftContent:E.a.createElement(b.a,{ref:function(t){e.LeftContentView=t?t.getWrappedInstance():e.scrollView},goBackAction:function(){},history:this.props.history}),onLeftClick:function(){e.LeftContentView.goHome()}},"\u666f\u533a\u8be6\u60c5"),E.a.createElement(g.a,{ref:function(t){e.scrollView=t?t.getWrappedInstance():e.scrollView}},this.renderHeaderView(),this.renderElementOperationView(),this.renderScoreView(),this.renderTicketListView(),this.renderMapView(),this.renderBasicViews(),this.renderSceneryListView(),this.props.isFetching?E.a.createElement(p.a,{toast:!0,text:"Loading..."}):null,E.a.createElement(C.a,{ref:function(t){e.photoBrowserView=t?t.getWrappedInstance():e.scrollView}})))}},{key:"goBack",value:function(){this.props.history.goBack()}},{key:"onDestroy",value:function(){var e=this.props.dispatch,t=this.props.match.params.code;e(Object(k.d)(t))}},{key:"renderElementOperationView",value:function(){var e=this;return this.props.detailItem?E.a.createElement(T.a,{code:this.props.match.params.code,onNearByTapped:function(){e.props.history.push({pathname:"/me/near-by",state:{centerLat:e.props.detailItem.Latitude,centerLng:e.props.detailItem.Longitude}})}}):null}},{key:"renderTicketListView",value:function(){var e=this;return this.props.ticketList&&0!==this.props.ticketList.length?this.props.ticketList.map(function(t,a){return e.renderTicketItemView(a)}):null}},{key:"renderTicketItemView",value:function(e){var t=this,a=this.props.ticketList[e];return E.a.createElement("div",{key:e,onClick:function(){return t.showBooking(a)}},E.a.createElement("div",{className:"ticketItemRow"},E.a.createElement("div",{className:"ticketItemLeft"},E.a.createElement("div",{className:"ticketItemName"},a.CnName),E.a.createElement("div",{className:"ticketItemTags"},E.a.createElement("div",{className:"ticketItemTag"},"\u5b98\u65b9"),E.a.createElement("div",{className:"ticketItemTag"},"\u5b9e\u540d\u5236"),E.a.createElement("div",{className:"ticketItemTag"},"\u5feb\u901f\u5165\u56ed"))),E.a.createElement("div",{className:"ticketItemRight"},E.a.createElement("div",{className:"ticketItemPrice"},E.a.createElement("div",{className:"ticketItemPriceLabel"},"\xa5"),E.a.createElement("div",{className:"ticketItemPriceValue"},a.TicketPrice)),a.IsReserve?E.a.createElement("div",{className:"ticketItemButton"},"\u7acb\u5373\u9884\u8ba2"):null)),e===this.props.ticketList.length-1?null:E.a.createElement("div",{className:"ticketItemSplitLine"}))}},{key:"showBooking",value:function(e){if(e.IsReserve){if(!this.props.isUserLogined)return void this.props.history.push("/me/login");var t=this.props.match.params.code;this.props.history.push({pathname:"/order/booking/"+t+"/"+e.Code+"/"+y.n.TICKET,state:{scenicName:this.props.detailItem.CnName}})}}},{key:"renderHeaderView",value:function(){if(!this.props.detailItem)return null;var e=N.a.getScenicStarCount(this.props.detailItem.AttractionsStarNo?this.props.detailItem.AttractionsStarNo:"0"),t=a(898),i=a(899);return E.a.createElement("div",{className:"scenicDetailHeader",onClick:this.showImageBrowser},this.renderHeaderImages(),E.a.createElement("div",{className:"scenicDetailHeaderBottom"},E.a.createElement("div",{className:"scenicDetailHeaderBottomText"},this.props.detailItem.CnName),E.a.createElement("div",{className:"scenicDetailHeaderBottomView"},E.a.createElement("div",{className:"scenicDetailHeaderBottomStars"},Array(5).fill(0).map(function(a,r){return E.a.createElement("img",{key:r,className:"scenicDetailHeaderBottomStar",src:r<e?t:i,alt:""})})),E.a.createElement("div",{className:"scenicDetailHeaderBottomText"},this.state.index,"/",this.props.detailItem.GetImage&&this.props.detailItem.GetImage.ImageList?this.props.detailItem.GetImage.ImageList.length:1))))}},{key:"renderScoreView",value:function(){return this.props.detailItem?E.a.createElement("div",{className:"scenicScoreView"},E.a.createElement("div",{className:"scenicScoreCircle"},E.a.createElement(S.a,{percent:20*this.state.Score,strokeWidth:"6",trailWidth:"6",strokeColor:"#42a6dc",trailColor:"#f0f0f0"}),E.a.createElement("div",{className:"scenicScoreCircleTextBox"},E.a.createElement("div",{style:{flex:1}}),E.a.createElement("div",{className:"scenicScoreCircleTextSubBox"},E.a.createElement("div",{className:"scenicScoreCircleText"},this.state.Score.toFixed(1)),E.a.createElement("div",{className:"scenicScoreCircleUnit"},"\u5206")),E.a.createElement("div",{style:{flex:1}}))),E.a.createElement("div",{className:"scenicScoreLines"},E.a.createElement("div",{className:"scenicScoreLine"},E.a.createElement("div",{className:"scenicScoreLineLabel"},"\u4ef7\u683c"),E.a.createElement(S.b,{className:"scenicScoreLineProgress",percent:20*this.state.PriceScore,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})),E.a.createElement("div",{className:"scenicScoreLine"},E.a.createElement("div",{className:"scenicScoreLineLabel"},"\u670d\u52a1"),E.a.createElement(S.b,{className:"scenicScoreLineProgress",percent:20*this.state.ServiceScore,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})),E.a.createElement("div",{className:"scenicScoreLine"},E.a.createElement("div",{className:"scenicScoreLineLabel"},"\u8bbe\u65bd"),E.a.createElement(S.b,{className:"scenicScoreLineProgress",percent:20*this.state.InstallationScore,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})),E.a.createElement("div",{className:"scenicScoreLine"},E.a.createElement("div",{className:"scenicScoreLineLabel"},"\u73af\u5883"),E.a.createElement(S.b,{className:"scenicScoreLineProgress",percent:20*this.state.EnvironmentScore,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})))):null}},{key:"renderHeaderImages",value:function(){var e=this;return this.props.detailItem&&this.props.detailItem.GetImage&&this.props.detailItem.GetImage.ImageList&&0!==this.props.detailItem.GetImage.ImageList.length?E.a.createElement(o.a,{className:"scenicDetailHeaderImgSlider",afterChange:function(){return e.imageChage()},autoplay:!0,dots:!1,swiping:!0,infinite:!0,selectedIndex:0,swipeSpeed:35},this.props.detailItem.GetImage.ImageList.map(function(e,t){return E.a.createElement("div",{key:t,className:"scenicDetailHeaderImg",style:{backgroundImage:"url("+e.ImgSrc+")"}})})):null}},{key:"imageChage",value:function(){this.state.index===this.props.detailItem.GetImage.ImageList.length?this.setState({index:1}):this.setState({index:this.state.index+1})}},{key:"renderMapView",value:function(){var e=this;if(!this.props.detailItem||!this.props.detailItem.Longitude||!this.props.detailItem.Latitude)return null;var t=2*window.innerWidth,a="http://api.map.baidu.com/staticimage?width="+t+"&height=250&markers="+this.props.detailItem.Longitude+","+this.props.detailItem.Latitude+"&markerStyles=-1,http://oe72hu540.bkt.clouddn.com/ico_pin_blu.png";return E.a.createElement("img",{className:"scenicDetailMapImg",src:a,onClick:function(){return e.showElementMarkerMap()},alt:""})}},{key:"renderBasicViews",value:function(){var e=this;return this.props.detailItem?E.a.createElement("div",{className:"scenicDetailInfoRows"},E.a.createElement("div",{className:"scenicDetailInfoRow"},E.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u5730\u5740"),E.a.createElement("div",{className:"scenicDetailInfoValue"},this.props.detailItem.Address)),this.props.detailItem.Telephone&&this.props.detailItem.Telephone.length>0?E.a.createElement("div",{className:"scenicDetailInfoRow"},E.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u7535\u8bdd"),E.a.createElement("div",{className:"scenicDetailInfoPhoneRow",onClick:function(){return N.a.openTel(e.props.detailItem.Telephone)}},E.a.createElement("div",{className:"scenicDetailInfoValue"},this.props.detailItem.Telephone),E.a.createElement("div",{style:{flex:1}}),E.a.createElement("img",{className:"scenicDetailInfoPhone",src:a(62),alt:""}))):null,E.a.createElement("div",{className:"scenicDetailInfoRow"},E.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u8425\u4e1a\u65f6\u95f4"),E.a.createElement("div",{className:"scenicDetailInfoValue"},this.props.detailItem.BusinesTime)),E.a.createElement("div",{className:"scenicDetailInfoRow"},E.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u666f\u533a\u7b80\u4ecb"),E.a.createElement("div",{className:"scenicDetailInfoValue scenicDetailMultDesc"},this.props.detailItem.Summary))):null}},{key:"renderSceneryListView",value:function(){var e=this;return this.props.sceneryList&&0!==this.props.sceneryList.length?E.a.createElement("div",null,E.a.createElement("div",{className:"sceneryListSplitLine"}),E.a.createElement("div",{className:"sceneryTitleBox"},E.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u5b50\u666f\u70b9"),E.a.createElement("div",{style:{flex:1}}),E.a.createElement("div",{className:"sceneryListMoreView",onClick:this.showSceneryList},"\u66f4\u591a ",E.a.createElement("img",{src:a(929),alt:""}))),E.a.createElement("div",{className:"sceneryListBox"},this.props.sceneryList.map(function(t,a){return e.renderSceneryView(a)}))):null}},{key:"renderSceneryView",value:function(e){var t=this;if(e>=10)return null;var a=this.props.sceneryList[e],i=a.GetImage&&a.GetImage.ImageFrontUrl?a.GetImage.ImageFrontUrl.replace("/Middle/","/Small/"):"";return E.a.createElement("div",{key:e,className:"sceneryItemView",onClick:function(){t.showSceneryDetail(e)}},E.a.createElement("img",{className:"sceneryItemImg",src:i,alt:""}),E.a.createElement("div",{className:"sceneryItemName"},a.CnName))}},{key:"loadData",value:function(){var e=this;this.props.dispatch(Object(k.a)(this.props.match.params.code)).then(function(){return e.props.dispatch(Object(k.c)(e.props.match.params.code))}).then(function(){return e.props.dispatch(Object(k.b)(e.props.match.params.code))})}},{key:"cacheScrollOffset",value:function(){var e=L.a.findDOMNode(this.scrollView).scrollTop;this.props.dispatch(Object(k.e)(this.props.match.params.code,e))}},{key:"restoreScrollViewPosition",value:function(){this.scrollView&&(isNaN(this.props.scrollViewOffset)?this.scrollView.scrollToY(0):this.scrollView.scrollToY(this.props.scrollViewOffset))}},{key:"showSceneryList",value:function(){this.cacheScrollOffset(),this.props.history.push("/scenic/scenery-list/"+this.props.match.params.code)}},{key:"showSceneryDetail",value:function(e){var t=this.props.sceneryList[e];this.cacheScrollOffset(),this.props.history.push("/scenic/scenery-detail/"+this.props.match.params.code+"/"+t.Code)}},{key:"startScoreAnimation",value:function(e){var t=this;setTimeout(function(){t.setState({Score:e.Score?e.Score:3,PriceScore:e.PriceScore?e.PriceScore:3,ServiceScore:e.ServiceScore?e.ServiceScore:3,InstallationScore:e.InstallationScore?e.InstallationScore:3,EnvironmentScore:e.EnvironmentScore?e.EnvironmentScore:3})},700)}},{key:"showElementMarkerMap",value:function(){this.cacheScrollOffset();var e=this.props.detailItem;this.props.history.push("/map/elementMarker/"+this.props.match.params.code+"/"+e.CnName+"/"+e.Address+"/"+e.Latitude+"/"+e.Longitude)}},{key:"showImageBrowser",value:function(){if(!this.props.detailItem||!this.props.detailItem.GetImage||!this.props.detailItem.GetImage.ImageList||0===this.props.detailItem.GetImage.ImageList.length)return null;for(var e=[],t=0;t<this.props.detailItem.GetImage.ImageList.length;t++){var a=this.props.detailItem.GetImage.ImageList[t];e.push(a.ImgSrc.replace("Small","Large"))}this.photoBrowserView.open(e)}}]),t}(f.PureComponent),V=function(e,t){var a=e.scenic.detailScreen[t.match.params.code];return Object.assign({},a,{isUserLogined:N.a.isUserLogined(e)})};_=Object(I.b)(V)(_),t.default=_},897:function(e,t,a){"use strict";function i(e){return{type:y.b.SCENIC.DETAIL.GO_BACK,code:e}}function r(e){return function(t,a){return t(v(e)),S(e).then(function(a){a=a&&a.results&&a.results.length>0?a.results[0]:a,t(L(e,a))}).catch(function(a){t(g(e,a))})}}function n(e){return function(t,a){return t(f(e)),h(e).then(function(a){a=a?a.results:[],t(E(e,a))}).catch(function(a){t(I(e,a))})}}function s(e){return function(t,a){return t(p(e)),m(e).then(function(a){a=a?a.results:[],t(d(e,a))}).catch(function(a){t(u(e,a))})}}function c(e,t){return{type:y.b.SCENIC.DETAIL.SET_DETAIL_SCROLL_OFFSET,code:e,scrollViewOffset:t}}function o(e,t){return{type:y.b.SCENIC.DETAIL.SET_SCENERY_LIST_SCROLL_OFFSET,code:e,scrollViewOffset:t}}function l(e,t,a){return{type:y.b.SCENIC.DETAIL.SET_SCENERY_DETAIL_SCROLL_OFFSET,code:e,sceneryCode:t,scrollViewOffset:a}}function m(e){var t={ConditionParams:{Params:{Code:e}}};return N.a.postToPortalWithUrl(N.a.HOST_E_BUSINESS,y.q.ELEMENTS.SceneryList,t).then(function(e){return e.json()})}function p(e){return{type:y.b.SCENIC.DETAIL.GET_SCENERY_LIST_REQUEST,code:e}}function d(e,t){return{type:y.b.SCENIC.DETAIL.GET_SCENERY_LIST_SUCCESS,code:e,sceneryList:t}}function u(e,t){return{type:y.b.SCENIC.DETAIL.GET_SCENERY_LIST_FAILURE,code:e,message:t}}function h(e){var t={ConditionParams:{Params:{Code:e,PlayDate:(new Date).formatDate("YYYY-MM-DD")}}};return N.a.postToPortalWithUrl(N.a.HOST_E_BUSINESS,y.q.ELEMENTS.AttractionsTicketList,t).then(function(e){return e.json()})}function f(e){return{type:y.b.SCENIC.DETAIL.GET_TICKET_LIST_REQUEST,code:e}}function E(e,t){return{type:y.b.SCENIC.DETAIL.GET_TICKET_LIST_SUCCESS,code:e,ticketList:t}}function I(e,t){return{type:y.b.SCENIC.DETAIL.GET_TICKET_LIST_FAILURE,code:e,message:t}}function S(e){var t={ConditionParams:{Params:{Code:e}}};return N.a.postToPortalWithUrl(N.a.HOST_E_BUSINESS,y.q.ELEMENTS.AttractionsDetail,t).then(function(e){return e.json()})}function v(e){return{type:y.b.SCENIC.DETAIL.GET_DETAIL_REQUEST,code:e}}function L(e,t){return{type:y.b.SCENIC.DETAIL.GET_DETAIL_SUCCESS,code:e,detailItem:t}}function g(e,t){return{type:y.b.SCENIC.DETAIL.GET_DETAIL_FAILURE,code:e,message:t}}t.d=i,t.a=r,t.c=n,t.b=s,t.e=c,t.g=o,t.f=l;var y=a(1),N=a(8)},898:function(e,t,a){e.exports=a.p+"static/media/ico_a_full@2x.a5d6eea0.png"},899:function(e,t,a){e.exports=a.p+"static/media/ico_a_empty@2x.f866e867.png"},929:function(e,t,a){e.exports=a.p+"static/media/more@2x.19f5c55a.png"}});
//# sourceMappingURL=9.11441b07.chunk.js.map