webpackJsonp([21],{887:function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function i(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var o=a(28),r=(a.n(o),a(29)),d=a.n(r),p=a(16),l=(a.n(p),a(17)),c=a.n(l),u=a(49),h=(a.n(u),a(50)),m=a.n(h),f=a(11),w=(a.n(f),a(12)),y=a.n(w),g=a(18),v=(a.n(g),a(19)),b=a.n(v),k=a(0),M=a.n(k),B=a(2),N=a(10),L=a(14),A=a.n(L),O=a(293),S=a.n(O),_=a(70),C=a(1),P=a(54),E=a(158),I=(a.n(E),a(302)),j=a(165),x=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),F=function(e){function t(e){n(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.name="",a.address="",a.lat="",a.lng="",a.point=null,a.name=a.props.match.params.name,a.address=a.props.match.params.address,a.lat=a.props.match.params.lat,a.lng=a.props.match.params.lng,a.point={lat:a.lat&&void 0!==a.lat?a.lat:a.props.latitude,lng:a.lng&&void 0!==a.lng?a.lng:a.props.longitude,address:a.address&&void 0!==a.address?a.address:a.props.address},a.state={mapHeight:0,keywords:"",showLoading:!0,resultList:[]},a.searchByKeywords=a.searchByKeywords.bind(a),a.chooseAddress=a.chooseAddress.bind(a),a}return i(t,e),x(t,[{key:"componentDidMount",value:function(){this.updateWindowDimensions(),this.updateNativeTitle(this.name)}},{key:"componentDidUpdate",value:function(e,t,a){this.props.baiduMapInited&&!e.baiduMapInited&&this.initMap(),!this.props.isLocationFetching&&e.isLocationFetching&&(this.point={lat:this.props.latitude,lng:this.props.longitude,address:this.props.address},this.getNearByPois(this.point))}},{key:"render",value:function(){var e=this;return M.a.createElement("div",{className:this.props.isFromNativeApp?"isFromNativeApp":null},this.props.isFromNativeApp?null:M.a.createElement(y.a,{mode:"dark",className:"navBar",icon:M.a.createElement(b.a,{type:"left"}),onLeftClick:function(){e.props.history.goBack()}},"\u4f4d\u7f6e\u9009\u62e9"),M.a.createElement(N.a,{className:"chooseAddressPage",ref:function(t){e.scrollView=t?t.getWrappedInstance():e.scrollView}},M.a.createElement("div",{id:"chooseAddressMap",style:{height:this.state.mapHeight+"px"}}),M.a.createElement(m.a,{className:"searchBar",style:{position:"absolute",top:"0",left:"0",right:"0"},placeholder:"\u8bf7\u8f93\u5165\u5173\u952e\u5b57",maxLength:8,defaultValue:this.state.keywords,onChange:function(t){e.setState({keywords:t})},onSubmit:this.searchByKeywords,ref:function(t){e.searchBar=t}}),this.renderAddressListView(),this.state.showLoading?M.a.createElement(c.a,{toast:!0,text:"Loading..."}):null))}},{key:"renderAddressListView",value:function(){var e=this;return this.state.resultList&&0!==this.state.resultList.length?M.a.createElement("div",{style:{height:this.state.mapHeight,overflow:"scroll"}},this.state.resultList.map(function(t,a){return M.a.createElement("div",{key:a,className:"resultRow",style:{borderBottomColor:"#999",borderWidth:"1px",borderBottomStyle:"dashed",padding:"5px 8px"},onClick:function(){e.chooseAddress(t)}},M.a.createElement("div",{style:{fontSize:"14px",color:"#78a1c6"},className:"resultItemTitle"},t.name),M.a.createElement("div",{style:{fontSize:"14px",color:"#999999"},className:"resultItemAddress"},t.address))})):null}},{key:"initMap",value:function(){var e=this;this.markerIcon=new window.BMap.Icon(a(284),new window.BMap.Size(30,30),{anchor:new window.BMap.Size(15,30),imageSize:new window.BMap.Size(30,30)}),this.map=this.map?this.map:new window.BMap.Map("chooseAddressMap"),this.map.centerAndZoom(new window.BMap.Point(P.a.instance.appCityLongitude,P.a.instance.appCityLatitude),11),this.map.addControl(new window.BMap.NavigationControl({type:window.BMAP_NAVIGATION_CONTROL_SMALL,anchor:window.BMAP_ANCHOR_BOTTOM_RIGHT,enableGeolocation:!0,offset:new window.BMap.Size(20,20)})),this.map.addEventListener("dragend",function(){e.getNearByPois(e.map.getCenter())}),this.getCurrentNearbyPois()}},{key:"updateWindowDimensions",value:function(){var e=this,t=window.innerHeight-A.a.findDOMNode(this).parentNode.offsetTop;this.setState({mapHeight:t/2},function(){e.props.baiduMapInited&&e.initMap()})}},{key:"searchByKeywords",value:function(){var e=this;if(!this.state.keywords)return void d.a.info("\u8bf7\u8f93\u5165\u5173\u952e\u5b57");this.searchBar.onCancel(),this.setState({showLoading:!0});var t="http://api.map.baidu.com/place/v2/search?q="+this.state.keywords+"&region=\u5168\u56fd&page_size=20&output=json&ak=edD6aFgNKfVBeAlaU6R9L9bc8dn2vrHo";t=encodeURI(t),S()(t).then(function(e){return e.json()}).then(function(t){e.setState({showLoading:!1}),t&&t.results&&t.results.length>0&&(e.addMark(t.results[0]),e.setState({resultList:t.results}))})}},{key:"addMark",value:function(e){if(!e||!e.location)return void d.a.info("\u5173\u952e\u5b57\u8303\u56f4\u592a\u5927\uff0c\u8bf7\u8f93\u5165\u5177\u4f53\u5730\u5740!");var t=new window.BMap.Point(e.location.lng,e.location.lat);this.map.setCenter(t),this.map.clearOverlays();var a=new window.BMap.Marker(t,{icon:this.markerIcon});this.map.addOverlay(a)}},{key:"chooseAddress",value:function(e){var t=this;e&&e.name&&e.address&&e.location&&this.props.dispatch(Object(I.b)(e)).then(function(){t.props.history.goBack()})}},{key:"getNearByPois",value:function(e){var t=this;if(e){var a=e.lat+","+e.lng,n="http://api.map.baidu.com/geocoder/v2/?location="+a+"&output=json&pois=1&ak="+C.c;S()(n).then(function(e){return e.json()}).then(function(e){if(t.setState({showLoading:!1}),e&&e.result&&e.result.pois&&e.result.pois.length>0){for(var a=[],n=0;n<e.result.pois.length;n++){var s=e.result.pois[n],i={name:s.name,address:s.addr,location:{lat:s.point.y,lng:s.point.x}};a.push(i),0===n&&t.addMark(i)}t.setState({resultList:a})}})}}},{key:"getCurrentNearbyPois",value:function(){this.point.lat>0&&this.point.lat>0?this.getNearByPois(this.point):this.props.dispatch(Object(j.c)(!0))}}]),t}(_.a),T=function(e,t){return{baiduMapInited:e.system.baiduMapInited,isFromNativeApp:e.native.isFromNativeApp,latitude:e.system.latitude,longitude:e.system.longitude,address:e.system.address,isLocationFetching:e.system.isFetching}};F=Object(B.b)(T)(F),t.default=F}});
//# sourceMappingURL=21.6a5daef5.chunk.js.map