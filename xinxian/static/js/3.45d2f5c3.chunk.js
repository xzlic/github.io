webpackJsonp([3],{859:function(e,t,a){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function r(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var n=a(35),c=(a.n(n),a(36)),o=a.n(c),l=a(17),m=(a.n(l),a(18)),d=a.n(m),p=a(11),u=(a.n(p),a(12)),h=a.n(u),f=a(9),E=(a.n(f),a(10)),I=a.n(E),v=a(0),g=a.n(v),S=a(2),L=a(50),y=(a.n(L),a(16)),N=a.n(y),w=a(13),k=a(1),C=a(19),T=a(865),D=a(45),_=a(272),G=(a.n(_),function(){function e(e,t){for(var a=0;a<t.length;a++){var i=t[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,a,i){return a&&e(t.prototype,a),i&&e(t,i),t}}()),b=function(e){function t(e){i(this,t);var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={AvgGrade:0,Grade1:0,Grade2:0,Grade3:0,Grade4:0,index:1,showImageBrowser:!1,imageList:[]},a.showSceneryList=a.showSceneryList.bind(a),a.showElementMarkerMap=a.showElementMarkerMap.bind(a),a.showImageBrowser=a.showImageBrowser.bind(a),a}return r(t,e),G(t,[{key:"componentDidMount",value:function(){this.props.detailItem?this.startScoreAnimation(this.props.detailItem):this.loadData(),this.restoreScrollViewPosition()}},{key:"componentWillReceiveProps",value:function(e){e.detailItem!==this.props.detailItem&&e.detailItem&&this.startScoreAnimation(e.detailItem)}},{key:"render",value:function(){var e=this;return g.a.createElement("div",null,g.a.createElement(h.a,{mode:"dark",className:"navBar",icon:g.a.createElement(I.a,{type:"left"}),onLeftClick:function(){var t=e.props.match.params.code,a=e.props.dispatch;e.props.history.goBack(),a(Object(T.d)(t))}},"\u666f\u533a\u8be6\u60c5"),g.a.createElement(w.a,{ref:function(t){e.scrollView=t}},this.renderHeaderView(),this.renderScoreView(),this.renderTicketListView(),this.renderMapView(),this.renderBasicViews(),this.renderSceneryListView(),this.props.isFetching?g.a.createElement(d.a,{toast:!0,text:"Loading..."}):null,g.a.createElement(D.a,{imageList:this.state.imageList,isOpen:this.state.showImageBrowser,hiddenImageBrowser:function(){e.setState({showImageBrowser:!1})}})))}},{key:"renderTicketListView",value:function(){var e=this;return this.props.ticketList&&0!==this.props.ticketList.length?this.props.ticketList.map(function(t,a){return e.renderTicketItemView(a)}):null}},{key:"renderTicketItemView",value:function(e){var t=this,a=this.props.ticketList[e];return g.a.createElement("div",{key:e,onClick:function(){return t.showBooking(a)}},g.a.createElement("div",{className:"ticketItemRow"},g.a.createElement("div",{className:"ticketItemLeft"},g.a.createElement("div",{className:"ticketItemName"},a.NAME),g.a.createElement("div",{className:"ticketItemTags"},g.a.createElement("div",{className:"ticketItemTag"},"\u5b98\u65b9"),g.a.createElement("div",{className:"ticketItemTag"},"\u5b9e\u540d\u5236"),g.a.createElement("div",{className:"ticketItemTag"},"\u5feb\u901f\u5165\u56ed"))),g.a.createElement("div",{className:"ticketItemRight"},g.a.createElement("div",{className:"ticketItemPrice"},g.a.createElement("div",{className:"ticketItemPriceLabel"},"\xa5"),g.a.createElement("div",{className:"ticketItemPriceValue"},a.SalePrice)),g.a.createElement("div",{className:"ticketItemButton"},"\u7acb\u5373\u9884\u8ba2"))),e===this.props.ticketList.length-1?null:g.a.createElement("div",{className:"ticketItemSplitLine"}))}},{key:"showBooking",value:function(e){if(!this.props.isUserLogined)return void this.props.history.push("/me/login");var t=this.props.match.params.code;this.props.history.push("/order/booking/"+t+"/"+e.CODE+"/"+k.f.TICKET)}},{key:"renderHeaderView",value:function(){if(!this.props.detailItem)return null;var e=this.props.detailItem.Zdxmc.length,t=a(867),i=a(868);return g.a.createElement("div",{className:"scenicDetailHeader",onClick:this.showImageBrowser},this.renderHeaderImages(),g.a.createElement("div",{className:"scenicDetailHeaderBottom"},g.a.createElement("div",{className:"scenicDetailHeaderBottomText"},this.props.detailItem.CnName),g.a.createElement("div",{className:"scenicDetailHeaderBottomView"},g.a.createElement("div",{className:"scenicDetailHeaderBottomStars"},new Array(5).fill(0).map(function(a,s){return g.a.createElement("img",{key:s,className:"scenicDetailHeaderBottomStar",src:s<e?t:i,alt:""})})),g.a.createElement("div",{className:"scenicDetailHeaderBottomText"},this.state.index,"/",this.props.detailItem.GetImage.ImageList.length))))}},{key:"renderScoreView",value:function(){return this.props.detailItem?g.a.createElement("div",{className:"scenicScoreView"},g.a.createElement("div",{className:"scenicScoreCircle"},g.a.createElement(L.Circle,{percent:20*this.state.AvgGrade,strokeWidth:"6",trailWidth:"6",strokeColor:"#42a6dc",trailColor:"#f0f0f0"}),g.a.createElement("div",{className:"scenicScoreCircleTextBox"},g.a.createElement("div",{style:{flex:1}}),g.a.createElement("div",{className:"scenicScoreCircleTextSubBox"},g.a.createElement("div",{className:"scenicScoreCircleText"},this.state.AvgGrade.toFixed(1)),g.a.createElement("div",{className:"scenicScoreCircleUnit"},"\u5206")),g.a.createElement("div",{style:{flex:1}}))),g.a.createElement("div",{className:"scenicScoreLines"},g.a.createElement("div",{className:"scenicScoreLine"},g.a.createElement("div",{className:"scenicScoreLineLabel"},"\u4ef7\u683c"),g.a.createElement(L.Line,{className:"scenicScoreLineProgress",percent:20*this.state.Grade1,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})),g.a.createElement("div",{className:"scenicScoreLine"},g.a.createElement("div",{className:"scenicScoreLineLabel"},"\u670d\u52a1"),g.a.createElement(L.Line,{className:"scenicScoreLineProgress",percent:20*this.state.Grade2,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})),g.a.createElement("div",{className:"scenicScoreLine"},g.a.createElement("div",{className:"scenicScoreLineLabel"},"\u8bbe\u65bd"),g.a.createElement(L.Line,{className:"scenicScoreLineProgress",percent:20*this.state.Grade3,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})),g.a.createElement("div",{className:"scenicScoreLine"},g.a.createElement("div",{className:"scenicScoreLineLabel"},"\u73af\u5883"),g.a.createElement(L.Line,{className:"scenicScoreLineProgress",percent:20*this.state.Grade4,strokeWidth:"4",trailWidth:"4",strokeColor:"#42a6dc",trailColor:"#f0f0f0"})))):null}},{key:"renderHeaderImages",value:function(){var e=this;return this.props.detailItem&&this.props.detailItem.GetImage&&this.props.detailItem.GetImage.ImageList&&0!==this.props.detailItem.GetImage.ImageList.length?g.a.createElement(o.a,{className:"scenicDetailHeaderImgSlider",afterChange:function(){return e.imageChage()},autoplay:!0,dots:!1,swiping:!0,infinite:!0,selectedIndex:0,swipeSpeed:35},this.props.detailItem.GetImage.ImageList.map(function(e,t){return g.a.createElement("div",{key:t,className:"scenicDetailHeaderImg",style:{backgroundImage:"url("+e.ImgSrc+")"}})})):null}},{key:"imageChage",value:function(){this.state.index===this.props.detailItem.GetImage.ImageList.length?this.setState({index:1}):this.setState({index:this.state.index+1})}},{key:"renderMapView",value:function(){var e=this;if(!this.props.detailItem||!this.props.detailItem.Longitude||!this.props.detailItem.Latitude)return null;var t=2*window.innerWidth,a="http://api.map.baidu.com/staticimage?width="+t+"&height=250&markers="+this.props.detailItem.Longitude+","+this.props.detailItem.Latitude+"&markerStyles=-1,http://oe72hu540.bkt.clouddn.com/ico_pin_blu.png";return g.a.createElement("img",{className:"scenicDetailMapImg",src:a,onClick:function(){return e.showElementMarkerMap()},alt:""})}},{key:"renderBasicViews",value:function(){var e=this;return this.props.detailItem?g.a.createElement("div",{className:"scenicDetailInfoRows"},g.a.createElement("div",{className:"scenicDetailInfoRow"},g.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u5730\u5740"),g.a.createElement("div",{className:"scenicDetailInfoValue"},this.props.detailItem.Address)),this.props.detailItem.Telephone&&this.props.detailItem.Telephone.length>0?g.a.createElement("div",{className:"scenicDetailInfoRow"},g.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u7535\u8bdd"),g.a.createElement("div",{className:"scenicDetailInfoPhoneRow",onClick:function(){return window.open("tel://"+e.props.detailItem.Telephone,"_self")}},g.a.createElement("div",{className:"scenicDetailInfoValue"},this.props.detailItem.Telephone),g.a.createElement("div",{style:{flex:1}}),g.a.createElement("img",{className:"scenicDetailInfoPhone",src:a(58),alt:""}))):null,g.a.createElement("div",{className:"scenicDetailInfoRow"},g.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u8425\u4e1a\u65f6\u95f4"),g.a.createElement("div",{className:"scenicDetailInfoValue"},this.props.detailItem.Businestime)),g.a.createElement("div",{className:"scenicDetailInfoRow"},g.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u666f\u533a\u7b80\u4ecb"),g.a.createElement("div",{className:"scenicDetailInfoValue scenicDetailMultDesc"},this.props.detailItem.Summary))):null}},{key:"renderSceneryListView",value:function(){var e=this;return this.props.sceneryList&&0!==this.props.sceneryList.length?g.a.createElement("div",null,g.a.createElement("div",{className:"sceneryListSplitLine"}),g.a.createElement("div",{className:"sceneryTitleBox"},g.a.createElement("div",{className:"scenicDetailInfoLabel"},"\u5b50\u666f\u70b9"),g.a.createElement("div",{style:{flex:1}}),g.a.createElement("div",{className:"sceneryListMoreView",onClick:this.showSceneryList},"\u66f4\u591a ",g.a.createElement("img",{src:a(905),alt:""}))),g.a.createElement("div",{className:"sceneryListBox"},this.props.sceneryList.map(function(t,a){return e.renderSceneryView(a)}))):null}},{key:"renderSceneryView",value:function(e){var t=this;if(e>=10)return null;var a=this.props.sceneryList[e],i=a.GetImage?a.GetImage.ImageFrontUrl:"";return g.a.createElement("div",{key:e,className:"sceneryItemView",onClick:function(){t.showSceneryDetail(e)}},g.a.createElement("img",{className:"sceneryItemImg",src:i,alt:""}),g.a.createElement("div",{className:"sceneryItemName"},a.CnName))}},{key:"loadData",value:function(){var e=this;this.props.dispatch(Object(T.a)(this.props.match.params.code)).then(function(){return e.props.dispatch(Object(T.c)(e.props.match.params.code))}).then(function(){return e.props.dispatch(Object(T.b)(e.props.match.params.code))})}},{key:"cacheScrollOffset",value:function(){var e=N.a.findDOMNode(this.scrollView).scrollTop;this.props.dispatch(Object(T.e)(this.props.match.params.code,e))}},{key:"restoreScrollViewPosition",value:function(){this.scrollView&&(isNaN(this.props.scrollViewOffset)?this.scrollView.scrollToY(0):this.scrollView.scrollToY(this.props.scrollViewOffset))}},{key:"showSceneryList",value:function(){this.cacheScrollOffset(),this.props.history.push("/scenic/scenery-list/"+this.props.match.params.code)}},{key:"showSceneryDetail",value:function(e){var t=this.props.sceneryList[e];this.cacheScrollOffset(),this.props.history.push("/scenic/scenery-detail/"+this.props.match.params.code+"/"+t.Code)}},{key:"startScoreAnimation",value:function(e){var t=this;setTimeout(function(){t.setState({AvgGrade:e.AvgGrade?e.AvgGrade:3,Grade1:e.Grade1?e.Grade1:3,Grade2:e.Grade2?e.Grade2:3,Grade3:e.Grade3?e.Grade3:3,Grade4:e.Grade4?e.Grade4:3})},700)}},{key:"showElementMarkerMap",value:function(){this.cacheScrollOffset();var e=this.props.detailItem;this.props.history.push("/map/elementMarker/"+this.props.match.params.code+"/"+e.CnName+"/"+e.Address+"/"+e.Latitude+"/"+e.Longitude)}},{key:"showImageBrowser",value:function(){if(!this.props.detailItem||!this.props.detailItem.GetImage||!this.props.detailItem.GetImage.ImageList||0===this.props.detailItem.GetImage.ImageList.length)return null;if(!this.state.imageList||this.state.imageList.length<=0){for(var e=[],t=0;t<this.props.detailItem.GetImage.ImageList.length;t++){var a=this.props.detailItem.GetImage.ImageList[t];e.push({src:a.ImgSrc.replace("Small","Large")})}this.setState({showImageBrowser:!0,imageList:e})}else this.setState({showImageBrowser:!0})}}]),t}(v.Component),A=function(e,t){var a=e.scenic.detailScreen[t.match.params.code];return Object.assign({},a,{isUserLogined:C.a.isUserLogined(e)})};b=Object(S.b)(A)(b),t.default=b},865:function(e,t,a){"use strict";function i(e){return{type:y.c.SCENIC.DETAIL.GO_BACK,code:e}}function s(e){return function(t,a){return t(g(e)),v(e).then(function(a){a=a&&a.results&&a.results.length>0?a.results[0]:a,t(S(e,a))}).catch(function(a){t(L(e,a))})}}function r(e){return function(t,a){return t(f(e)),h(e).then(function(a){a=a?a.results:[],t(E(e,a))}).catch(function(a){t(I(e,a))})}}function n(e){return function(t,a){return t(d(e)),m(e).then(function(a){a=a?a.results:[],t(p(e,a))}).catch(function(a){t(u(e,a))})}}function c(e,t){return{type:y.c.SCENIC.DETAIL.SET_DETAIL_SCROLL_OFFSET,code:e,scrollViewOffset:t}}function o(e,t){return{type:y.c.SCENIC.DETAIL.SET_SCENERY_LIST_SCROLL_OFFSET,code:e,scrollViewOffset:t}}function l(e,t,a){return{type:y.c.SCENIC.DETAIL.SET_SCENERY_DETAIL_SCROLL_OFFSET,code:e,sceneryCode:t,scrollViewOffset:a}}function m(e){var t=N.a.HOST_E_BUSINESS+"/api/Attractions/GetSceneryList",a={type:"app",Code:e};return N.a.getData(t,a).then(function(e){return e.json()})}function d(e){return{type:y.c.SCENIC.DETAIL.GET_SCENERY_LIST_REQUEST,code:e}}function p(e,t){return{type:y.c.SCENIC.DETAIL.GET_SCENERY_LIST_SUCCESS,code:e,sceneryList:t}}function u(e,t){return{type:y.c.SCENIC.DETAIL.GET_SCENERY_LIST_FAILURE,code:e,message:t}}function h(e){var t=N.a.HOST_E_BUSINESS+"/api/Attractions/GetTicketList",a=new Date,i=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),s={type:"app",Code:e,selecttime:i};return N.a.getData(t,s).then(function(e){return e.json()})}function f(e){return{type:y.c.SCENIC.DETAIL.GET_TICKET_LIST_REQUEST,code:e}}function E(e,t){return{type:y.c.SCENIC.DETAIL.GET_TICKET_LIST_SUCCESS,code:e,ticketList:t}}function I(e,t){return{type:y.c.SCENIC.DETAIL.GET_TICKET_LIST_FAILURE,code:e,message:t}}function v(e){var t=N.a.HOST_E_BUSINESS+"/api/Attractions/GetAttractionsDetail",a={type:"app",Code:e};return N.a.getData(t,a).then(function(e){return e.json()})}function g(e){return{type:y.c.SCENIC.DETAIL.GET_DETAIL_REQUEST,code:e}}function S(e,t){return{type:y.c.SCENIC.DETAIL.GET_DETAIL_SUCCESS,code:e,detailItem:t}}function L(e,t){return{type:y.c.SCENIC.DETAIL.GET_DETAIL_FAILURE,code:e,message:t}}t.d=i,t.a=s,t.c=r,t.b=n,t.e=c,t.g=o,t.f=l;var y=a(1),N=a(8)},867:function(e,t,a){e.exports=a.p+"static/media/ico_a_full@2x.a5d6eea0.png"},868:function(e,t,a){e.exports=a.p+"static/media/ico_a_empty@2x.f866e867.png"},905:function(e,t,a){e.exports=a.p+"static/media/more@2x.19f5c55a.png"}});
//# sourceMappingURL=3.45d2f5c3.chunk.js.map